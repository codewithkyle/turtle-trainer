(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{30:function(module,exports,__webpack_require__){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)});Object.defineProperty(exports,"__esModule",{value:!0});var Module_1=__webpack_require__(7),Application_1=__webpack_require__(1),Env_1=__webpack_require__(2),SocketManager_1=__webpack_require__(35),Client_1=__webpack_require__(29),Login=function(_super){function Login(view,uuid){var _this=_super.call(this,view,uuid)||this;return _this.handleSubmit=function(e){e.preventDefault(),""!==_this._tokenInput.value?(Env_1.Env.startLoading(),SocketManager_1.SocketManager.emit("joinRoom",{token:_this._tokenInput.value}),SocketManager_1.SocketManager.receive("roomResponse",_this.roomJoinResponse,_this)):_this.handleError()},_this.handleInput=function(){""!==_this._tokenInput.value?_this._loginButton.classList.add("is-visible"):_this._loginButton.classList.remove("is-visible")},_this.createNewRoom=function(e){e.preventDefault(),Env_1.Env.startLoading(),SocketManager_1.SocketManager.emit("createRoom")&&SocketManager_1.SocketManager.receive("roomCreated",_this.roomCreationResponse,_this)},Env_1.Env.isDebug&&console.log("%c[Module Manager] %ccreated new %c"+Login.index+" %cmodule with an ID of %c"+uuid,"color:#4882fd","color:#eee","color:#48eefd","color:#eee","color:#48eefd"),_this._loginForm=_this.view,_this._loginButton=_this.view.querySelector(".js-submit-button"),_this._tokenInput=_this._loginForm.querySelector("input#token"),_this._createRoomButton=_this.view.querySelector(".js-create-room-button"),_this}return __extends(Login,_super),Login.prototype.handleError=function(){Env_1.Env.stopLoading(),this._tokenInput.parentElement.querySelector(".js-error").innerHTML="Invalid token",this._tokenInput.classList.add("is-invalid"),this._loginButton.classList.remove("is-visible")},Login.prototype.GetStartupForm=function(firstUser){Env_1.Env.startLoading();var formSlug=firstUser?"creation-form":"startup-form";fetch(window.location.origin+"/"+formSlug+".html").then(function(request){return request.text()}).then(function(response){Env_1.Env.stopLoading();var startupFormWrapper=document.createElement("div");startupFormWrapper.classList.add("o-setup-form"),startupFormWrapper.innerHTML=response,document.body.querySelector(".js-main-view").appendChild(startupFormWrapper),startupFormWrapper.classList.add("is-visible")}).catch(function(e){console.error("Something went wrong:",e)})},Login.prototype.roomCreationResponse=function(data,scope){Env_1.Env.stopLoading(),Env_1.Env.isDebug&&console.log("Server responded with the room token "+data.token),new Client_1.Client(data.token),scope.view.classList.add("is-hidden"),scope.GetStartupForm(!0)},Login.prototype.roomJoinResponse=function(data,scope){Env_1.Env.stopLoading(),data.success&&data.token?(new Client_1.Client(data.token),scope.view.classList.add("is-hidden"),scope.GetStartupForm(!1)):data.error&&Env_1.Env.isDebug&&console.error("Server responded with:",data.error)},Login.prototype.afterMount=function(){this._loginForm.addEventListener("submit",this.handleSubmit),this._tokenInput.addEventListener("blur",this.handleInput),this._tokenInput.addEventListener("keyup",this.handleInput),this._createRoomButton.addEventListener("click",this.createNewRoom)},Login.prototype.beforeDestroy=function(){},Login.index="Login",Login}(Module_1.Module);exports.Login=Login,modules[Login.index]=Login,Env_1.Env.isDebug&&console.log("%c[Module Manager] %cmodule %c"+Login.index+" %chas finished loading","color:#4882fd","color:#eee","color:#48eefd","color:#eee"),Application_1.Application.mountModules()}},[[30,0,3,2,13,24,25,14,15,4,5,6,7,8,9,10,11,12,16,17,18,19,20,21,22,23,26,27,28,1]]]);